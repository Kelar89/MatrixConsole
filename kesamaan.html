<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Kalkulator Penyelesaian Kesamaan Matriks</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Roboto+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background: #0d1117; color: #fff; }
        .panel { background: #1f2937; border: 1px solid #374151; border-radius: 0.75rem; padding: 1.5rem; }
        .cell { background: #0d1117; border: 1px solid #374151; border-radius: 0.5rem; padding: 0.5rem; width: 100%; text-align: center; font-family: 'Roboto Mono', monospace; }
        .cell:focus { outline: none; border-color: #22d3ee; box-shadow: 0 0 0 3px rgba(34, 211, 238, .2); }
        .btn { border-radius: .5rem; padding: .6rem 1rem; font-weight: 600; color: #fff; transition: background-color .2s; cursor: pointer; }
        .btn-green { background: #22c55e; } .btn-green:hover { background: #16a34a; }
        .btn-blue { background: #3b82f6; } .btn-blue:hover { background: #2563eb; }
        .btn-red { background: #ef4444; } .btn-red:hover { background: #dc2626; }
        .step { background: #161b22; border-left: 4px solid #22d3ee; border-radius: .25rem; padding: 1rem; margin-bottom: 1rem; }
        .math-container { overflow-x: auto; padding: 0.2rem; }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto space-y-6">
        <h1 class="text-3xl font-bold text-center">Kesamaan Dua Matriks (A = B)</h1>

        <div class="panel space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <div>
                    <label class="block mb-1 text-sm text-gray-300">Ukuran Matriks (n Ã— n)</label>
                    <input id="sizeInput" type="number" min="1" max="5" value="2" class="cell" />
                </div>
                <div class="flex gap-4">
                    <button id="randomBtn" class="btn btn-blue w-full">Isi Acak</button>
                    <button id="resetBtn" class="btn btn-red w-full">Reset</button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-[1fr_auto_1fr] gap-4 items-center">
                <div>
                    <h2 class="text-xl font-semibold text-center mb-2">Matriks A</h2>
                    <div id="matA" class="grid gap-2 justify-center"></div>
                </div>
                <div class="text-3xl font-bold text-gray-400">=</div>
                <div>
                    <h2 class="text-xl font-semibold text-center mb-2">Matriks B</h2>
                    <div id="matB" class="grid gap-2 justify-center"></div>
                </div>
            </div>
            <button id="solveBtn" class="btn btn-green w-full text-lg">Selesaikan</button>
        </div>

        <div class="panel">
            <h2 class="text-xl font-bold mb-3">Langkah Penyelesaian</h2>
            <div id="out" class="space-y-4 text-gray-200">
                Masukkan ekspresi pada matriks lalu klik <b>Selesaikan</b>.
            </div>
        </div>
    </div>

<script>
    const sizeInput = document.getElementById('sizeInput');
    const matA = document.getElementById('matA');
    const matB = document.getElementById('matB');
    const out = document.getElementById('out');
    const solveBtn = document.getElementById('solveBtn');
    const resetBtn = document.getElementById('resetBtn');
    const randomBtn = document.getElementById('randomBtn');

    function createGrid(container, n) {
        container.innerHTML = '';
        container.style.gridTemplateColumns = `repeat(${n}, 1fr)`;
        for (let i = 0; i < n * n; i++) {
            const inp = document.createElement('input');
            inp.className = 'cell';
            inp.placeholder = '0';
            container.appendChild(inp);
        }
    }

    function getMatrix(container, n) {
        const vals = [...container.querySelectorAll('input')].map(i => i.value.trim() || '0');
        const M = [];
        for (let i = 0; i < n; i++) M.push(vals.slice(i * n, (i + 1) * n));
        return M;
    }

    function toTex(expr) {
        try {
            return math.parse(expr).toTex();
        } catch {
            return expr.replace(/_/g, '\\_');
        }
    }

    function toTexMatrix(M) {
        const body = M.map(row => row.map(toTex).join('&')).join('\\\\');
        return `\\begin{bmatrix}${body}\\end{bmatrix}`;
    }

    function typeset() {
        if (window.MathJax) {
            MathJax.typesetPromise([out]);
        }
    }

    function solve() {
        out.innerHTML = ``;
        const n = parseInt(sizeInput.value);
        const MA = getMatrix(matA, n);
        const MB = getMatrix(matB, n);
        let html = '';

        html += `<div class="step"><b>1. Persamaan Awal (A = B)</b>
                    <div class="mt-2 math-container">\\( ${toTexMatrix(MA)} = ${toTexMatrix(MB)} \\)</div>
                 </div>`;

        let eqPairs = [];
        for (let i = 0; i < n; i++) {
            for (let j = 0; j < n; j++) {
                if (MA[i][j].trim() !== MB[i][j].trim()) {
                    eqPairs.push({L: MA[i][j], R: MB[i][j], loc: `(baris ${i+1}, kolom ${j+1})`});
                }
            }
        }

        if (eqPairs.length === 0) {
            html += `<div class="step"><p class="text-green-400">Semua elemen sudah sama, tidak ada yang perlu diselesaikan.</p></div>`;
            out.innerHTML = html;
            typeset();
            return;
        }

        html += `<div class="step"><b>2. Penyelesaian Langkah Demi Langkah</b></div>`;

        eqPairs.forEach(pair => {
            const variableMatch = (pair.L + pair.R).match(/[a-zA-Z]/);
            if (!variableMatch) return;
            const variable = variableMatch[0];

            let valVar1 = math.evaluate(pair.L, { [variable]: 1 });
            let valVar0 = math.evaluate(pair.L, { [variable]: 0 });
            let coeff = valVar1 - valVar0;
            let constant = valVar0;

            let langkah = `<div class="step">
                <b>Mencari ${variable} dari elemen ${pair.loc}:</b>
                <div class="math-container">\\( ${toTex(pair.L)} = ${toTex(pair.R)} \\)</div>
                <p>Pindahkan konstanta ke kanan:</p>
                <div class="math-container">\\( ${coeff}${variable} = (${pair.R}) - (${constant}) \\)</div>
                <div class="math-container">\\( ${coeff}${variable} = ${math.simplify(`(${pair.R}) - (${constant})`).toString()} \\)</div>
                <p>Bagi kedua ruas dengan ${coeff}:</p>
                <div class="math-container">\\( ${variable} = ${math.simplify(`((${pair.R}) - (${constant}))/(${coeff})`).toString()} \\)</div>
                <div class="math-container font-bold text-green-400">Hasil: \\( ${variable} = ${math.format(math.simplify(`((${pair.R}) - (${constant}))/(${coeff})`))} \\)</div>
            </div>`;

            html += langkah;
        });

        out.innerHTML = html;
        typeset();
    }

    function randomize() {
        const vars = ['x', 'y', 'z', 'a', 'b', 'c'];
        [matA, matB].forEach(cont => {
            cont.querySelectorAll('input').forEach(inp => {
                if (Math.random() > 0.5) {
                    const k = Math.floor(Math.random() * 9) + 1;
                    const v = vars[Math.floor(Math.random() * vars.length)];
                    const s = Math.random() > 0.5 ? '+' : '-';
                    const c = Math.floor(Math.random() * 9) + 1;
                    inp.value = `${k}${v} ${s} ${c}`;
                } else {
                    inp.value = String(Math.floor(Math.random() * 21) - 10);
                }
            });
        });
    }

    function reset() {
        const n = parseInt(sizeInput.value);
        createGrid(matA, n);
        createGrid(matB, n);
        if (n === 2) {
            const exA = ['2 + 5x', '7', '3y - 2', '4'];
            const exB = ['12', '7', '10', '4'];
            matA.querySelectorAll('input').forEach((el, i) => el.value = exA[i] || '');
            matB.querySelectorAll('input').forEach((el, i) => el.value = exB[i] || '');
        }
        out.innerHTML = 'Masukkan ekspresi pada matriks lalu klik <b>Selesaikan</b>.';
        typeset();
    }

    function init() {
        const n = parseInt(sizeInput.value);
        createGrid(matA, n);
        createGrid(matB, n);
        reset();
    }

    sizeInput.addEventListener('input', init);
    solveBtn.addEventListener('click', solve);
    resetBtn.addEventListener('click', reset);
    randomBtn.addEventListener('click', randomize);

    init();
</script>
</body>
</html>
