<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Kesamaan Matriks Simbolik</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&family=Roboto+Mono&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #0d1117; color: white; background-image: radial-gradient(circle at 1px 1px, #374151 1px, transparent 0); background-size: 20px 20px; }
        .panel-box { background-color: #1f2937; padding: 1.5rem; border-radius: 1rem; border: 1px solid #374151; }
        .form-input { background-color: #0d1117; border: 1px solid #374151; border-radius: 0.5rem; padding: 0.6rem 0.8rem; transition: border-color 0.2s, box-shadow 0.2s; width: 100%; }
        .form-input:focus { outline: none; border-color: #22d3ee; box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.2); }
        .matrix-cell { font-family: 'Roboto Mono', monospace; text-align: center; height: 52px; font-size: 1rem; }
        .result-step { background-color: #161b22; border-left: 4px solid #22d3ee; padding: 1rem; margin-bottom: 1rem; border-radius: 0.25rem; }
        .btn { padding: 0.6rem 1.25rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; border: none; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%;}
        .btn-green { background-color: #22c55e; color: white; } .btn-green:hover { background-color: #16a34a; }
        .btn-indigo { background-color: #6366f1; color: white; } .btn-indigo:hover { background-color: #4f46e5; }
        .btn-red { background-color: #ef4444; color: white; } .btn-red:hover { background-color: #dc2626; }
        .math-container { overflow-x: auto; padding-bottom: 0.5rem; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-white mb-6 text-center">Kalkulator Kesamaan Dua Matriks (A = B)</h1>
        
        <div class="panel-box mb-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center mb-6">
                <div>
                    <label for="matrixSize" class="block text-sm font-medium text-gray-300 mb-1">Ukuran Matriks (n x n)</label>
                    <input id="matrixSize" type="number" min="1" max="5" value="2" class="form-input">
                </div>
                <div class="flex gap-4">
                    <button id="randomizeBtn" class="btn btn-indigo text-sm">Isi Acak</button>
                    <button id="resetBtn" class="btn btn-red text-sm">Reset</button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center border-t border-b border-gray-700 py-6">
                <div class="w-full">
                    <h2 class="text-xl font-bold text-center mb-4">Matriks A</h2>
                    <div id="matrixAContainer" class="grid gap-3 justify-center"></div>
                </div>
                <div class="w-full">
                    <h2 class="text-xl font-bold text-center mb-4">Matriks B</h2>
                    <div id="matrixBContainer" class="grid gap-3 justify-center"></div>
                </div>
            </div>
            <div class="mt-6">
                 <button id="computeBtn" class="btn-green w-full text-lg">Selesaikan & Tentukan Nilai Variabel</button>
            </div>
        </div>

        <div class="panel-box">
            <h2 class="text-xl font-bold mb-4">Penyelesaian:</h2>
            <div id="outputContainer" class="space-y-4"><p class="text-gray-400">Masukkan ekspresi pada matriks, lalu tekan selesaikan.</p></div>
        </div>
    </div>

    <script>
        // --- Elemen DOM & Fungsi Bantuan ---
        const sizeInput = document.getElementById('matrixSize');
        const computeBtn = document.getElementById('computeBtn');
        const randomizeBtn = document.getElementById('randomizeBtn');
        const resetBtn = document.getElementById('resetBtn');
        const outputContainer = document.getElementById('outputContainer');
        const matrixAContainer = document.getElementById('matrixAContainer');
        const matrixBContainer = document.getElementById('matrixBContainer');

        const createGrid = (container, n) => {
            container.innerHTML = '';
            container.style.gridTemplateColumns = `repeat(${n}, minmax(0, 1fr))`;
            for (let i = 0; i < n * n; i++) {
                const inp = document.createElement('input');
                inp.type = 'text';
                inp.className = 'form-input matrix-cell';
                container.appendChild(inp);
            }
        };

        const getMatrixFrom = (container, n) => {
            const inputs = container.querySelectorAll('input');
            let matrix = [];
            for (let i = 0; i < n; i++) {
                let row = [];
                for (let j = 0; j < n; j++) {
                    const val = inputs[i * n + j].value.trim();
                    row.push(val === '' ? '0' : val);
                }
                matrix.push(row);
            }
            return matrix;
        };
        
        const formatLatex = (str) => {
            try { return math.parse(str).toTex(); } catch { return str; }
        };

        // --- Logika Utama ---
        const solveSystem = () => {
            const n = parseInt(sizeInput.value);
            const matrixA = getMatrixFrom(matrixAContainer, n);
            const matrixB = getMatrixFrom(matrixBContainer, n);

            outputContainer.innerHTML = '<p class="text-gray-400">Menganalisis dan menghitung...</p>';
            let stepsHTML = '';
            let finalSolutions = {};

            const matrixALatex = `\\begin{bmatrix}${matrixA.map(r => r.map(formatLatex).join('&')).join('\\\\')}\\end{bmatrix}`;
            const matrixBLatex = `\\begin{bmatrix}${matrixB.map(r => r.map(formatLatex).join('&')).join('\\\\')}\\end{bmatrix}`;
            stepsHTML += `<div class="result-step"><strong>Langkah 1: Persamaan Awal</strong><p>Diberikan kesamaan matriks A = B.</p><div class="math-container">\\( A = ${matrixALatex}, \\; B = ${matrixBLatex} \\)</div></div>`;

            const allText = matrixA.flat().join(' ') + ' ' + matrixB.flat().join(' ');
            const variables = [...new Set(allText.match(/[a-zA-Z]/g) || [])];
            
            if (variables.length === 0) {
                outputContainer.innerHTML = '<p class="text-yellow-400">Tidak ada variabel (seperti x, y, z) yang ditemukan pada matriks.</p>';
                return;
            }

            stepsHTML += `<div class="result-step"><strong>Langkah 2: Mencari Nilai Variabel</strong><p>Kita akan menyelesaikan setiap variabel dengan menyamakan elemen yang bersesuaian.</p></div>`;
            
            let equationCount = 0;
            for (let i = 0; i < n; i++) {
                for (let j = 0; j < n; j++) {
                    const exprA = matrixA[i][j];
                    const exprB = matrixB[i][j];
                    
                    if (exprA.trim() !== exprB.trim()) {
                        const equationStr = `(${exprA}) - (${exprB})`;
                        const eqVars = variables.filter(v => new RegExp(v).test(equationStr));
                        
                        if (eqVars.length === 1) { 
                            const variable = eqVars[0];
                            equationCount++;
                            stepsHTML += `<div class="result-step"><strong>Penyelesaian untuk variabel '${variable}' (dari elemen baris ${i+1}, kolom ${j+1}):</strong>`;
                            try {
                                stepsHTML += `<div class="math-container">\\( ${formatLatex(exprA)} = ${formatLatex(exprB)} \\)</div>`;
                                
                                // --- BAGIAN SOLVER YANG DIROMBAK TOTAL ---
                                const simplifiedNode = math.simplify(equationStr);
                                
                                // Coba rasionalkan. Ini akan mengubahnya menjadi bentuk polinomial
                                const rationalizedNode = math.rationalize(simplifiedNode);
                                
                                stepsHTML += `<p class="mt-2">Sederhanakan persamaan menjadi bentuk ax + b = 0:</p><div class="math-container">\\( ${rationalizedNode.toTex()} = 0 \\)</div>`;
                                
                                // Periksa apakah hasilnya adalah polinomial linear yang bisa dipecahkan
                                if (rationalizedNode && rationalizedNode.coefficients && rationalizedNode.coefficients.length === 2 && rationalizedNode.coefficients[1] != 0) {
                                    const coeffs = rationalizedNode.coefficients;
                                    const b_coeff = coeffs[0]; // konstanta b
                                    const a_coeff = coeffs[1]; // koefisien a dari ax
                                    
                                    const solution = math.fraction(-b_coeff / a_coeff);
                                    finalSolutions[variable] = solution;

                                    stepsHTML += `<p class="mt-2">Hasil akhir untuk variabel ini:</p><div class="math-container font-bold text-green-400">\\( ${variable} = ${solution.toTex()} \\)</div>`;
                                } else {
                                    stepsHTML += `<p class="text-yellow-400">Persamaan ini bukan linear sederhana (bukan bentuk ax+b=0) dan tidak dapat diselesaikan oleh kalkulator ini.</p>`;
                                }

                            } catch (e) {
                                stepsHTML += `<p class="text-red-400">Gagal memproses persamaan: ${e.message}.</p>`;
                            }
                            stepsHTML += `</div>`;
                        }
                    }
                }
            }

            if (equationCount === 0) {
                stepsHTML += `<div class="result-step"><p>Tidak ditemukan persamaan dengan satu variabel yang bisa diselesaikan secara langsung.</p></div>`;
            }

            if (Object.keys(finalSolutions).length > 0) {
                const solutionSummary = Object.entries(finalSolutions)
                    .map(([variable, sol]) => `\\(${variable} = ${sol.toTex()}\\)`)
                    .join(', ');
                stepsHTML += `<div class="result-step bg-green-900/50 border-green-500"><strong>Hasil Akhir Ditemukan:</strong><p class="text-xl mt-2">${solutionSummary}</p></div>`;
            }
            
            outputContainer.innerHTML = stepsHTML;
            if (window.MathJax) MathJax.typesetPromise([outputContainer]);
        };

        const resetAll = () => {
            const n = parseInt(sizeInput.value);
            createGrid(matrixAContainer, n);
            createGrid(matrixBContainer, n);
            outputContainer.innerHTML = '<p class="text-gray-400">Masukkan ekspresi pada matriks, lalu tekan selesaikan.</p>';
        };

        const randomizeAll = () => {
            const n = parseInt(sizeInput.value);
            const vars = ['x', 'y', 'z', 'a', 'b'];
            [matrixAContainer, matrixBContainer].forEach(container => {
                container.querySelectorAll('input').forEach(inp => {
                    const coinFlip = Math.random();
                    if (coinFlip > 0.7) { 
                        const num1 = Math.floor(Math.random() * 9) + 1;
                        const num2 = Math.floor(Math.random() * 9) + 1;
                        const op = Math.random() > 0.5 ? '+' : '-';
                        const v = vars[Math.floor(Math.random() * vars.length)];
                        inp.value = `${num1}${v} ${op} ${num2}`;
                    } else { 
                        inp.value = Math.floor(Math.random() * 21) - 10;
                    }
                });
            });
        };

        const setupAndReset = () => {
            const n = parseInt(sizeInput.value);
            createGrid(matrixAContainer, n);
            createGrid(matrixBContainer, n);

            if (n === 2) { // Contoh default saat ukuran 2x2
                const exampleA = ['8', '3z+4', '1', '-18'];
                const exampleB = ['-2', '7y-6', '18', '3a+4'];
                matrixAContainer.querySelectorAll('input').forEach((inp, i) => inp.value = exampleA[i] || '');
                matrixBContainer.querySelectorAll('input').forEach((inp, i) => inp.value = exampleB[i] || '');
            }
            outputContainer.innerHTML = '<p class="text-gray-400">Masukkan ekspresi pada matriks, lalu tekan selesaikan.</p>';
        };

        // --- Event Listener ---
        sizeInput.addEventListener('input', setupAndReset);
        computeBtn.addEventListener('click', solveSystem);
        resetBtn.addEventListener('click', resetAll);
        randomizeBtn.addEventListener('click', randomizeAll);
        
        setupAndReset();
    </script>
</body>
</html>